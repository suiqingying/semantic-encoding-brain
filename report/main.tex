% !TeX program = xelatex
% !TeX output-file = main.pdf
% 使用 ctexrep 获取原生 chapter 层级
\documentclass[UTF8,a4paper,zihao=-4,fontset=none]{ctexrep}

% ===================== 1. 基础页面设置 =====================
\usepackage[a4paper,
  top=2.8cm, bottom=2.8cm, left=2.4cm, right=2.4cm,
  headheight=25pt, marginparwidth=2cm
]{geometry}
\usepackage{setspace}
\setstretch{1.5}
\usepackage{indentfirst}
\setlength{\parindent}{2em}
\usepackage{microtype}
\usepackage{enumitem}
\setlist{nosep}
\usepackage{tabularx}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{booktabs}
\usepackage{longtable}
\usepackage{float}

% ===================== 2. 字体设置 =====================
\usepackage{fontspec}
\setmainfont{Times New Roman}
\setsansfont{Times New Roman}
\setmonofont{JetBrains Mono}
% 使用宋体并启用假粗体以消除缺失粗体警告
\setCJKmainfont{SimSun}[BoldFont=SimSun,AutoFakeBold=2]
\setCJKsansfont{SimSun}[BoldFont=SimSun,AutoFakeBold=2]
\setCJKmonofont{SimSun}[AutoFakeBold=2]
\newCJKfontfamily{\TitleCJK}{SimSun}[BoldFont=SimSun,AutoFakeBold=2]

% ===================== 3. Nord极光配色方案 =====================
\usepackage{xcolor}

% Nord Polar Night (深色背景系)
\definecolor{Nord0}{HTML}{2E3440}   % 最深，用于强调文字
\definecolor{Nord1}{HTML}{3B4252}   % 深灰
\definecolor{Nord2}{HTML}{434C5E}   % 中灰
\definecolor{Nord3}{HTML}{4C566A}   % 浅灰

% Nord Snow Storm (浅色背景系)
\definecolor{Nord4}{HTML}{D8DEE9}   % 浅灰背景
\definecolor{Nord5}{HTML}{E5E9F0}   % 更浅
\definecolor{Nord6}{HTML}{ECEFF4}   % 最浅，接近白色

% Nord Frost (冰蓝色系 - 主色调)
\definecolor{Nord7}{HTML}{8FBCBB}   % 青绿色
\definecolor{Nord8}{HTML}{88C0D0}   % 冰蓝色 - 主色
\definecolor{Nord9}{HTML}{81A1C1}   % 蓝灰色
\definecolor{Nord10}{HTML}{5E81AC}  % 深蓝色

% Nord Aurora (极光色系 - 强调色)
\definecolor{Nord11}{HTML}{BF616A}  % 红色
\definecolor{Nord12}{HTML}{D08770}  % 橙色
\definecolor{Nord13}{HTML}{EBCB8B}  % 黄色
\definecolor{Nord14}{HTML}{A3BE8C}  % 绿色
\definecolor{Nord15}{HTML}{B48EAD}  % 紫色

% 语义化别名
\definecolor{BrandColor}{HTML}{5E81AC}      % Nord10 深蓝 - 主品牌色
\definecolor{AccentColor}{HTML}{88C0D0}     % Nord8 冰蓝 - 强调色
\definecolor{DarkText}{HTML}{2E3440}        % Nord0 深色文字
\definecolor{LightGrayBG}{HTML}{ECEFF4}     % Nord6 浅色背景
\definecolor{SectionNum}{HTML}{81A1C1}      % Nord9 章节数字

\colorlet{Primary}{BrandColor}
\colorlet{Secondary}{Nord9}
\colorlet{Ink}{DarkText}

% ===================== 4. 图形与视觉组件 =====================
\usepackage{graphicx}
\usepackage{caption}
\captionsetup{font={small,sf,color=Ink!80},labelfont={bf,color=BrandColor},labelsep=quad}
% 以 report/ 为工作目录编译：图片路径相对当前 tex 文件
\graphicspath{{figures/}{figures/brainmaps/}}
\usepackage{tikz}
\usetikzlibrary{shapes, shadows, positioning, calc, backgrounds, fadings}
\usepackage{tcolorbox}
\tcbuselibrary{skins, breakable}
\usepackage{xurl}
\setlength{\emergencystretch}{2em}
\sloppy
\hbadness=10000
\vbadness=10000
\hfuzz=20pt
\vfuzz=10pt

% 摘要盒子设计：Nord极光风格
\newtcolorbox{AbstractBox}{
  enhanced,
  breakable,
  colback=Nord6,              % Nord浅色背景
  colframe=Nord8,             % 冰蓝边框
  coltitle=Nord10,            % 深蓝标题
  fonttitle=\TitleCJK\bfseries\large,
  title={摘\quad 要},
  detach title,
  before upper={\tcbtitle\par\vspace{0.5em}},
  frame hidden,
  leftrule=4pt,               % 左侧极光装饰线
  arc=2mm,
  left=15pt, right=10pt, top=12pt, bottom=12pt,
  shadow={1mm}{-1mm}{0mm}{Nord4!50}
}

% ===================== 5. 标题样式系统 =====================
\usepackage{titlesec}

% Chapter 样式
\titleformat{\chapter}
  {\TitleCJK\sffamily\bfseries\huge\color{Nord10}}
  {\makebox[0pt][l]{\hspace{-0.4em}\raisebox{1.5ex}{\color{Nord8!30}\fontsize{70}{70}\selectfont\thechapter}}}
  {0em}
  {}
  [{\vspace{-0.5ex}\color{Nord8!50}\titlerule[2pt]}]
\titlespacing*{\chapter}{0pt}{4.5ex plus 1ex minus .2ex}{2.5ex plus .2ex}

% Section 样式
\titleformat{\section}
  {\TitleCJK\sffamily\bfseries\Large\color{Nord0}}
  {}
  {0em}
  {\tikz[baseline=(current bounding box.east),outer sep=0pt]
    \fill[Nord8] (0,0) rectangle (0.6em, 1.2em);
   \hspace{0.6em}\thesection\hspace{0.8em}}
\titlespacing*{\section}{0pt}{3ex plus 1ex minus .2ex}{1.5ex plus .2ex}

% Subsection 样式
\titleformat{\subsection}
  {\TitleCJK\sffamily\large\bfseries\color{Nord9}}
  {\thesubsection}
  {1em}
  {}

% ===================== 6. 目录重构 =====================
\usepackage{titletoc}

\renewcommand{\contentsname}{\TitleCJK\bfseries\Huge 目录}

% Chapter 目录条目（只显示标题，不显示编号）
\titlecontents{chapter}[0em]
  {\addvspace{12pt}\sffamily\bfseries\large}
  {}
  {}
  {\hfill\color{Nord10}\contentspage}

% Section 目录条目
\titlecontents{section}[3.5em]
  {\addvspace{6pt}\sffamily\small}
  {\contentslabel[\color{Nord3}\thecontentslabel]{2.8em}}
  {}
  {\titlerule*[0.8pc]{.}\contentspage}

% Subsection 目录条目
\titlecontents{subsection}[6.0em]
  {\addvspace{2pt}\sffamily\footnotesize}
  {\contentslabel[\color{Nord3!80}\thecontentslabel]{3.0em}}
  {}
  {\titlerule*[0.6pc]{.}\contentspage}

% ===================== 7. 页眉页脚 =====================
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}
\fancyhead[L]{\sffamily\color{Nord3}\footnotesize \leftmark}
\fancyhead[R]{\sffamily\color{Nord3}\footnotesize \CourseName}
\fancyfoot[C]{
  \tikz\node[
    rectangle,
    fill=Nord10,
    text=white,
    rounded corners=3pt,
    inner sep=4pt,
    minimum width=2.2em
  ]{\small\thepage};
}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}

% ===================== 8. 链接设置 =====================
\usepackage{hyperref}

% ===================== 信息宏定义 =====================
\newcommand{\StudentName}{潘宇轩}
\newcommand{\StudentID}{2023K8009991004}
\newcommand{\Department}{人工智能学院}
\newcommand{\Major}{人工智能}
\newcommand{\CourseName}{认知神经科学}

\newcommand{\PaperTitle}{语义编码与多模态对齐：综述与实验报告}
\newcommand{\PaperSubtitle}{基于故事听觉 fMRI 的预训练模型特征比较与相关工作整合}
\newcommand{\PaperTitleEn}{Semantic encoding and multimodal alignment: a review and experimental report}

% hyperref 需要在相关宏定义之后设置，确保 \PaperTitle、\StudentName 已定义
\hypersetup{
  colorlinks=true,
  linkcolor=BrandColor,
  urlcolor=AccentColor,
  citecolor=BrandColor,
  pdfborder={0 0 0},
  pdftitle={\PaperTitle},
  pdfauthor={\StudentName}
}

% ===================== 全局图片插图命令 =====================
\newcommand{\InsertFig}[4]{%
  \begin{figure}[tbp]
    \centering
    \includegraphics[width=#2,height=0.78\textheight,keepaspectratio]{#1}%
    \caption{#3}%
    \label{#4}%
  \end{figure}%
}

% ===================== 附录：原始文件嵌入 =====================
\usepackage{fancyvrb}

\begin{document}

% ===================== 封面设计（复用综述风格） =====================
\begin{titlepage}
  \thispagestyle{empty}
  \newgeometry{margin=0cm}
  \begin{tikzpicture}[remember picture,overlay]
    % Nord 渐变背景与细网格
    \path[shade, left color=Nord10!90, right color=Nord7!85]
      (current page.north west) rectangle (current page.south east);
    \foreach \y in {0.05,0.15,...,0.95} {
      \draw[white, opacity=0.05, line width=0.5pt]
        ([yshift=\y\paperheight]current page.west) -- ([yshift=\y\paperheight]current page.east);
    }
    \foreach \x in {0.1,0.25,...,0.9} {
      \draw[white, opacity=0.06, line width=0.5pt]
        ([xshift=\x\paperwidth]current page.south) -- ([xshift=\x\paperwidth]current page.north);
    }
    % 角落极光圆斑
    \fill[Nord8!28, opacity=0.65] ([xshift=-2cm,yshift=1cm]current page.north east) circle (3.5cm);
    \fill[Nord12!24, opacity=0.55] ([xshift=2cm,yshift=-1cm]current page.south west) circle (4cm);
    \node[
      anchor=center,
      yshift=0.02\paperheight,
      rounded corners=4mm,
      fill=Nord6,
      fill opacity=0.90,
      text opacity=1,
      draw=Nord8!40,
      draw opacity=1,
      line width=0.8pt,
      inner xsep=18pt,
      inner ysep=16pt,
      drop shadow={opacity=0.18, shadow xshift=0mm, shadow yshift=-1.2mm}
    ] at (current page.center) {%
      \begin{minipage}{0.78\paperwidth}
        \centering
        \tikz\node[fill=Nord8!20, text=Nord10, rounded corners=18pt, inner sep=9pt]
          {\sffamily\bfseries\large \CourseName};\\[1.1cm]

        {\rmfamily\bfseries\fontsize{34}{46}\selectfont\color{Nord0} \PaperTitle}\\[0.35cm]
        {\TitleCJK\sffamily\Large\color{Nord0!80} \PaperSubtitle}\\[0.45cm]
        {\fontspec{TeX Gyre Pagella}\itshape\fontsize{13}{18}\selectfont\color{Nord3} \PaperTitleEn}\\[1.0cm]

        \tikz\draw[Nord13, line width=1.6pt] (0,0) -- (4.8,0);\\[1.0cm]

        \renewcommand{\arraystretch}{1.55}
        \sffamily\color{Nord0}
        \begin{tabular}{r@{\hspace{1em}}l}
          \textbf{\color{Nord9} 报告人} & \large \StudentName \\
          \textbf{\color{Nord9} 学\quad 号} & \large \StudentID \\
          \textbf{\color{Nord9} 院\quad 系} & \large \Department \\
          \textbf{\color{Nord9} 专\quad 业} & \large \Major \\
          \textbf{\color{Nord9} 日\quad 期} & \large \today \\
        \end{tabular}
      \end{minipage}%
    };
  \end{tikzpicture}
\end{titlepage}
\restoregeometry

% ===================== 摘要页（不使用列表，全文段落） =====================
\clearpage
\begin{AbstractBox}
本报告将“相关工作综述”与“当前项目实验结果”合并呈现。综述部分围绕自然语言刺激下的语义脑图绘制 \cite{Huth2016,Zhang2020}、预测编码与集成建模框架 \cite{Schrimpf2021,Antonello2023,Kumar2024}、自监督语音表征与大脑对齐 \cite{Baevski2020,Millet2023}、组合语义与上下文表征 \cite{Peters2018,Devlin2019,Radford2019,Toneva2022} 以及连续语义重构的解码方向 \cite{Tang2023}，建立本实验的理论与方法背景。实验部分基于当前项目目录中已生成的结果文件撰写，所有数值均来自 \texttt{results/summary.csv}、\texttt{results/roi.csv} 与各模型目录下保存的相关图（\texttt{corr\_layer*.npy} 以及融合的 \texttt{corr\_*.npy}）。研究目标是在故事听觉 fMRI 数据上，对比文本模型、音频模型、多模态模型在不同层与不同时间窗口（TR 窗口）条件下的脑预测性能，并结合 ROI 统计与可视化图像分析区域偏好。实验采用统一的对齐、降维与时延展开流程，并在多被试上进行单次训练/测试划分的岭回归评估，从而得到可复现的全脑相关图。报告呈现两类图像：其一为统计图（模型对比与窗口趋势、ROI Top20），由 \texttt{report/scripts/make\_figures.py} 读取现有结果自动生成；其二为脑图，可视化来自 \texttt{src/run\_plot\_corr\_maps.py} 对保存的 corr map 进行映射绘制。
\end{AbstractBox}
\clearpage

% ===================== 目录页（带装饰，无多余空白页） =====================
{
  \newgeometry{top=3cm, bottom=3cm, left=3cm, right=3cm}
  % 目录页背景装饰
  \begin{tikzpicture}[remember picture, overlay]
     \node[anchor=north east, text=Nord5, font=\bfseries\fontsize{120}{120}\selectfont, rotate=-90] 
       at ([xshift=-1cm, yshift=-3cm]current page.north east) {CONTENT};
     \draw[line width=2pt, Nord8!30] ([xshift=-2.5cm]current page.north east) -- ([xshift=-2.5cm]current page.south east);
  \end{tikzpicture}

  \hypersetup{linkcolor=Nord0} 
  % 避免 \tableofcontents 内部的清页指令让目录另起一整页
  \begingroup
    \let\clearpage\relax
    \let\cleardoublepage\relax
    \tableofcontents
  \endgroup
  \restoregeometry
}

% ===================== 正文（章节拆分在独立文件中） =====================
\chapter{第一部分：相关工作综述与研究动机}
本部分用于建立实验的研究语境与方法参照。自然叙事刺激下的语义地图研究表明，语义信息在皮层上呈现分布式组织，并跨越传统语言区与默认模式网络等大尺度系统 \cite{Huth2016,Zhang2020}。在模型侧，集成对齐研究将不同语言模型与脑数据进行系统比较，指出架构、训练目标与层级表示共同影响对齐程度 \cite{Schrimpf2021,Antonello2023,Kumar2024}。在语音与多模态方向，自监督语音表征能够在较少标注下形成与人类加工相近的表征梯度 \cite{Baevski2020,Millet2023}。在语义组成与上下文依赖方面，ELMo、BERT、GPT-2 等模型提供了不同的上下文表示机制，为探查“组合意义”在脑中的可测表现提供了可操作的特征空间 \cite{Peters2018,Devlin2019,Radford2019,Toneva2022}。与此同时，连续语义重构工作展示了以语义而非字面文本为目标的解码可能性，为“编码模型”与“解码模型”的统一评估提供了参考 \cite{Tang2023}。

\input{chapters/01_introduction}
\input{chapters/02_predictive_coding}
\input{chapters/03_semantic_mapping}
\input{chapters/04_learning_mechanisms}
\input{chapters/05_compositional_semantics}
\input{chapters/06_decoding_reconstruction}
\input{chapters/07_methodology}
\input{chapters/08_crosslingual_multimodal}
\input{chapters/09_discussion}

\chapter{第二部分：实验设计、方法与结果}
\input{experiment_chapters/01_background}
\input{experiment_chapters/02_data_alignment}
\input{experiment_chapters/03_models_features}
\input{experiment_chapters/04_encoding_evaluation}
\input{experiment_chapters/05_text_results}
\input{experiment_chapters/06_audio_results}
\input{experiment_chapters/07_multimodal_results}
\input{experiment_chapters/08_fusion_results}
\input{experiment_chapters/09_roi_discussion}
\input{experiment_chapters/10_conclusion}

% ===================== 附录：结果文件位置（不逐行嵌入） =====================
\appendix
\chapter{附录：结果文件位置与复现说明}
本报告的所有数值与脑图均来自项目根目录下的 \texttt{results/} 与 \texttt{report/figures/}。
其中，模型评估与汇总表位于 \texttt{results/summary.csv}；ROI 统计位于 \texttt{results/roi.csv}；
各模型的相关图数组为 \texttt{corr\_layer*.npy}（融合为 \texttt{corr\_*.npy}），保存在对应的
\texttt{results/text/}、\texttt{results/audio/}、\texttt{results/multimodal/} 与 \texttt{results/fusion/} 目录下。
统计图由 \texttt{report/scripts/make\_figures.py} 读取上述结果自动生成到 \texttt{report/figures/}；
脑图由 \texttt{src/run\_plot\_corr\_maps.py} 读取相关图数组并输出到 \texttt{report/figures/brainmaps/}。

\clearpage
\bibliographystyle{plain}
\bibliography{refs}

\end{document}