% !TeX program = xelatex
% !TeX output-file = report.pdf
\documentclass[UTF8,a4paper,12pt,fontset=none]{ctexart}

% ===================== 1. 基础页面设置 =====================
\usepackage[a4paper,
  top=2.8cm, bottom=2.8cm, left=2.4cm, right=2.4cm,
  headheight=20pt, marginparwidth=2cm
]{geometry}
\usepackage{setspace}
\setstretch{1.45} % 稍微增加行间距，提升正文呼吸感
\usepackage{indentfirst}
\setlength{\parindent}{2em}
\usepackage{microtype}
\usepackage{enumitem}
\setlist{nosep}
\usepackage{tabularx}
\usepackage{amsmath}
\usepackage{amssymb}

% ===================== 2. 字体设置 =====================
\usepackage{fontspec}

% 预设字体名（可修改）——优先现代、清晰、层次分明的一套
% 统一采用跨平台可用的自由字体，避免因缺字导致的警告
\newcommand{\LatinMainPref}{TeX Gyre Pagella} % Palatino 风格
\newcommand{\LatinSansPref}{Noto Sans}        % 类 Segoe UI 的几何无衬线
\newcommand{\LatinMonoPref}{JetBrains Mono}
\newcommand{\CJKMainPref}{Noto Serif CJK SC} % 宋体/衬线风格
\newcommand{\CJKSansPref}{Noto Sans CJK SC}  % 标题与小节用无衬线

% 英文字体加载
\IfFontExistsTF{\LatinMainPref}{\setmainfont{\LatinMainPref}}{\setmainfont{Latin Modern Roman}}
\IfFontExistsTF{\LatinSansPref}{\setsansfont{\LatinSansPref}}{\setsansfont{Latin Modern Sans}}
\IfFontExistsTF{\LatinMonoPref}{\setmonofont{\LatinMonoPref}}{\setmonofont{Latin Modern Mono}}

% 中文字体加载（正文宋体，标题黑体系），兼容无对应字体时的开源回退
\IfFontExistsTF{\CJKMainPref}{\setCJKmainfont{\CJKMainPref}}{\setCJKmainfont{FandolSong-Regular}}
\IfFontExistsTF{\CJKSansPref}{\setCJKsansfont{\CJKSansPref}}{\setCJKsansfont{FandolHei-Regular}}

% 修复字体设置，覆盖默认字体

\setCJKmonofont{\CJKSansPref}

% 标题专用字体：使用中文无衬线（如微软雅黑），形成与正文的层次对比
\IfFontExistsTF{\CJKSansPref}{
  \newCJKfontfamily{\TitleCJK}{\CJKSansPref}[FakeBold=2]
}{
  \newCJKfontfamily{\TitleCJK}{FandolHei-Regular}[FakeBold=2]
}

% ===================== 3. 高级配色方案 =====================
\usepackage{xcolor}

% 核心色板：深青 + 陶土 + 炭黑
\definecolor{BrandColor}{HTML}{005F6B}      % 更深邃的青色，适合学术
\definecolor{AccentColor}{HTML}{D97757}     % 陶土色，用于点缀
\definecolor{DarkText}{HTML}{1A1C20}        % 接近纯黑的深灰，阅读不累眼
\definecolor{LightGrayBG}{HTML}{F4F6F7}     % 极淡的冷灰背景
\definecolor{SectionNum}{HTML}{8BA6AC}      % 章节数字的低调色

% 语义化别名
\colorlet{Primary}{BrandColor}
\colorlet{Secondary}{BrandColor!85!black}
\colorlet{Ink}{DarkText}

% ===================== 4. 图形与视觉组件 =====================
\usepackage{graphicx}
\usepackage{float}
\usepackage{caption}
\captionsetup{font={small,sf,color=Ink!80},labelfont={bf,color=BrandColor},labelsep=quad}
\graphicspath{{figures/}{figures/original/}{figures/ai/}}

\usepackage{tikz}
\usetikzlibrary{shapes, shadows, positioning, calc, backgrounds, fadings}

\usepackage{tcolorbox}
\tcbuselibrary{skins, breakable}

% 摘要盒子设计：更现代的悬浮卡片风格
\newtcolorbox{AbstractBox}{
  enhanced,
  breakable,
  colback=BrandColor!4,       % 极淡背景
  colframe=BrandColor,        % 边框颜色
  coltitle=BrandColor,        % 标题文字颜色（反转风格）
  fonttitle=\TitleCJK\bfseries\large,
  title={摘\quad 要},
  detach title,               % 分离标题，自定义布局
  before upper={\tcbtitle\par\vspace{0.5em}}, % 标题放在内容上方
  frame hidden,               % 隐藏默认边框
  leftrule=3pt,               % 只保留左侧装饰线
  arc=0mm,
  left=15pt, right=10pt, top=10pt, bottom=10pt,
  shadow={0mm}{0mm}{0mm}{white} % 无阴影，更扁平洁净
}

% ===================== 5. 标题样式系统 =====================
\usepackage{titlesec}

% Section: 现代杂志风格
\titleformat{\section}
  {\TitleCJK\sffamily\bfseries\huge\color{BrandColor}}
  {\makebox[0pt][l]{\hspace{-0.4em}\raisebox{1.5ex}{\color{SectionNum!25}\fontsize{70}{70}\selectfont\thesection}}} % 巨大的背景数字
  {0em}
  {}
  [{\vspace{-0.5ex}\color{BrandColor!30}\titlerule[2pt]}] 

\titlespacing*{\section}{0pt}{4.5ex plus 1ex minus .2ex}{2.5ex plus .2ex}

% Subsection: 几何方块引导
\titleformat{\subsection}
  {\TitleCJK\sffamily\Large\bfseries\color{DarkText}}
  {}
  {0em}
  {\tikz[baseline=(current bounding box.east),outer sep=0pt]
    \fill[AccentColor] (0,0) rectangle (0.6em, 1.2em);
   \hspace{0.6em}\thesubsection\hspace{0.8em}}

% Subsection (numberless): 不显示编号（用于目录/参考文献等 \section* 映射后的标题）
\titleformat{name=\subsection,numberless}
  {\TitleCJK\sffamily\Large\bfseries\color{DarkText}}
  {}
  {0em}
  {\tikz[baseline=(current bounding box.east),outer sep=0pt]
    \fill[AccentColor] (0,0) rectangle (0.6em, 1.2em);
   \hspace{0.6em}}

\titlespacing*{\subsection}{0pt}{3ex plus 1ex minus .2ex}{1.5ex plus .2ex}

% Subsubsection: 极简加粗
\titleformat{\subsubsection}
  {\TitleCJK\sffamily\large\bfseries\color{BrandColor}}
  {\thesubsubsection}
  {1em}
  {}

% ===================== 6. 目录重构 =====================
\usepackage{titletoc}

\renewcommand{\contentsname}{\TitleCJK\bfseries\Huge 目录}

% Section 目录条目
\titlecontents{section}[2.5em]
  {\addvspace{12pt}\sffamily\bfseries\large}
  {\contentslabel[\color{BrandColor}\thecontentslabel]{2.5em}}
  {}
  {\hfill\color{BrandColor}\contentspage}

% Subsection 目录条目
\titlecontents{subsection}[5.5em]
  {\addvspace{3pt}\sffamily\small}
  {\contentslabel[\color{Ink!60}\thecontentslabel]{3.0em}}
  {}
  {\titlerule*[0.8pc]{.}\contentspage}

% ===================== 7. 页眉页脚 =====================
\usepackage{fancyhdr}
\pagestyle{fancy}
\setlength{\headheight}{24pt}
\fancyhf{}
\fancyhead[L]{\sffamily\color{Ink!40}\footnotesize \leftmark}
\fancyhead[R]{\sffamily\color{Ink!40}\footnotesize \CourseName}
\fancyfoot[C]{
  \tikz\node[
    rectangle,
    fill=BrandColor,
    text=white,
    rounded corners=2pt,
    inner sep=3pt,
    minimum width=2em
  ]{\small\thepage};
}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}

% ===================== 8. 链接设置 =====================
\usepackage{hyperref}

% ===================== 信息宏定义 =====================
\newcommand{\StudentName}{潘宇轩}
\newcommand{\StudentID}{2023K8009991004}
\newcommand{\Department}{人工智能学院}
\newcommand{\Major}{人工智能}
\newcommand{\CourseName}{认知神经科学}

\newcommand{\PaperTitle}{神经语言模型与大脑语义表征的综合文献综述}
\newcommand{\PaperSubtitle}{融合计算模型与语言神经科学的关键议题}
\newcommand{\PaperTitleEn}{Neural language models and brain semantic representations: an integrative review}
\newcommand{\PaperReference}{Huth (2016), Schrimpf (2021), Kumar (2024), Millet (2023), Toneva (2022), Tang (2023) 等}

% hyperref 需要在相关宏定义之后设置，确保 \PaperTitle、\StudentName 已定义
\hypersetup{
  colorlinks=true,
  linkcolor=BrandColor,
  urlcolor=AccentColor,
  citecolor=BrandColor,
  pdfborder={0 0 0},
  pdftitle={\PaperTitle},
  pdfauthor={\StudentName}
}

% ===================== 兼容性层 (Shim) =====================
% 将 Kumar2024 的 ctexbook 结构映射到 ctexart 模板
\newcommand{\frontmatter}{}
\newcommand{\mainmatter}{}
\newcommand{\backmatter}{}

% 保存原始的 section 命令
\let\realSection\section
\let\realSubsection\subsection
\let\realSubsubsection\subsubsection

% 重定义层级：Chapter -> Section, Section -> Subsection
% 不强制分页，保证章节衔接紧密
\makeatletter
\NewDocumentCommand{\chapter}{s o m}{%
  \IfBooleanTF{#1}{%
    \IfNoValueTF{#2}{\realSection*{#3}}{\realSection*[#2]{#3}}%
  }{%
    \IfNoValueTF{#2}{\realSection{#3}}{\realSection[#2]{#3}}%
  }%
}
\RenewDocumentCommand{\section}{s o m}{%
  \IfBooleanTF{#1}{%
    \IfNoValueTF{#2}{\realSubsection*{#3}}{\realSubsection*[#2]{#3}}%
  }{%
    \IfNoValueTF{#2}{\realSubsection{#3}}{\realSubsection[#2]{#3}}%
  }%
}
\RenewDocumentCommand{\subsection}{s o m}{%
  \IfBooleanTF{#1}{%
    \IfNoValueTF{#2}{\realSubsubsection*{#3}}{\realSubsubsection*[#2]{#3}}%
  }{%
    \IfNoValueTF{#2}{\realSubsubsection{#3}}{\realSubsubsection[#2]{#3}}%
  }%
}
\makeatother


% ===================== 文档开始 =====================
\begin{document}

% ===================== 全局图片插图命令 =====================
% \InsertFig{文件名(不含路径)}{宽度}{标题}{标签}
\newcommand{\InsertFig}[4]{%
  \begin{figure}[htbp]
    \centering
    \includegraphics[width=#2]{#1}%
    \caption{#3}%
    \label{#4}%
  \end{figure}%
}

% ===================== 旗舰级封面设计（不引用图片） =====================
\begin{titlepage}
  \thispagestyle{empty}
  \newgeometry{margin=0cm}

  \begin{tikzpicture}[remember picture,overlay]
    % 全页背景：柔和渐变（避免上下分割）
    \path[shade, top color=BrandColor!88!black, bottom color=BrandColor!8]
      (current page.north west) rectangle (current page.south east);

    % 轻微网格装饰（全页）
    \foreach \x in {0.08,0.20,...,0.92} {
      \draw[white, opacity=0.04, line width=0.6pt]
        ([xshift=\x\paperwidth]current page.north west) -- ([xshift=\x\paperwidth]current page.south west);
    }

    % 一体化信息层：与背景融合的半透明层（避免“白块覆盖”）
    \node[
      anchor=center,
      yshift=0.02\paperheight,
      rounded corners=4mm,
      fill=white,
      fill opacity=0.86,
      text opacity=1,
      draw=white,
      draw opacity=0.15,
      line width=0.6pt,
      inner xsep=18pt,
      inner ysep=16pt,
      drop shadow={opacity=0.12, shadow xshift=0mm, shadow yshift=-1mm}
    ] at (current page.center) {%
      \begin{minipage}{0.78\paperwidth}
        \centering
        \tikz\node[fill=BrandColor!10, text=BrandColor, rounded corners=20pt, inner sep=9pt]
          {\sffamily\bfseries\large \CourseName};\\[1.0cm]

        {\rmfamily\bfseries\fontsize{33}{44}\selectfont\color{DarkText} \PaperTitle}\\[0.35cm]
        {\TitleCJK\sffamily\Large\color{DarkText!80} \PaperSubtitle}\\[0.45cm]
        {\fontspec{TeX Gyre Pagella}\itshape\fontsize{13}{18}\selectfont\color{Ink!65} \PaperTitleEn}\\[0.9cm]

        \tikz\draw[AccentColor, line width=1.4pt] (0,0) -- (4,0);\\[0.9cm]
        {\sffamily\bfseries\color{SectionNum} \PaperReference}\\[1.1cm]

        \renewcommand{\arraystretch}{1.55}
        \sffamily\color{DarkText}
        \begin{tabular}{r@{\hspace{1em}}l}
          \textbf{\color{BrandColor!80} 报告人} & \large \StudentName \\
          \textbf{\color{BrandColor!80} 学\quad 号} & \large \StudentID \\
          \textbf{\color{BrandColor!80} 院\quad 系} & \large \Department \\
          \textbf{\color{BrandColor!80} 专\quad 业} & \large \Major \\
          \textbf{\color{BrandColor!80} 日\quad 期} & \large \today \\
        \end{tabular}
      \end{minipage}%
    };
  \end{tikzpicture}
\end{titlepage}
\restoregeometry

% ===================== 摘要页 =====================
\clearpage
\input{chapters/00_abstract}
\clearpage

% ===================== 目录页 =====================
\clearpage
{
  \newgeometry{top=3cm, bottom=3cm, left=3cm, right=3cm}
  \hypersetup{linkcolor=DarkText}
  \tableofcontents
  \restoregeometry
}
\clearpage

% ===================== 正文 =====================
\input{chapters/01_introduction}
\input{chapters/02_predictive_coding}
\input{chapters/03_semantic_mapping}
\input{chapters/04_learning_mechanisms}
\input{chapters/05_compositional_semantics}
\input{chapters/06_decoding_reconstruction}
\input{chapters/07_methodology}
\input{chapters/08_crosslingual_multimodal}
\input{chapters/09_discussion}
\input{chapters/10_conclusion}

% ===================== 参考文献 =====================
\clearpage
\bibliographystyle{plain}
\bibliography{refs}

\end{document}
